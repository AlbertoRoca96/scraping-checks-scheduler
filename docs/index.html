<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Scraping & Checks — Live Reports</title>
  <style>
    body{font:16px/1.4 ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial}
    header{display:flex;justify-content:space-between;align-items:center;margin:1rem 0}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:16px}
    section{border:1px solid #e5e7eb;border-radius:12px;padding:12px}
    h2{margin:.25rem 0 .5rem 0;font-size:1rem}
    table{width:100%;border-collapse:collapse}
    th,td{border-top:1px solid #e5e7eb;padding:6px 8px;font-size:.9rem;vertical-align:top}
    th{background:#f9fafb;text-align:left}
    code{background:#f3f4f6;padding:2px 4px;border-radius:6px}
    .ok{color:#059669}.changed{color:#b45309}.err{color:#b91c1c}.muted{color:#6b7280}
  </style>
</head>
<body>
  <header>
    <h1>Scraping & Checks — Live Reports</h1>
    <div class="muted" id="stamp"></div>
  </header>

  <div class="grid" id="grid"></div>

  <script>
    const groups = ["default","seo","price","compliance"];
    const grid = document.getElementById('grid');
    const stamp = document.getElementById('stamp');

    async function loadJSON(path) {
      const res = await fetch(path, {cache: "no-store"});
      if (!res.ok) throw new Error(path + " -> " + res.status);
      return res.json();
    }

    function sectionHTML(group, summary) {
      const rows = summary.map(s => `
        <tr>
          <td><code>${s.name}</code></td>
          <td>${s.changed ? '<span class="changed">changed</span>' : '<span class="muted">—</span>'}</td>
          <td>${s.changedKeys?.join(", ") || ""}</td>
          <td>${s.error ? `<span class="err">${s.error}</span>` : ""}</td>
          <td><a href="data/latest/${s.name}.json">latest</a></td>
        </tr>
      `).join("");
      return `
        <section>
          <h2>Group: ${group}</h2>
          <table>
            <thead><tr><th>Check</th><th>Changed</th><th>Keys</th><th>Error</th><th>JSON</th></tr></thead>
            <tbody>${rows}</tbody>
          </table>
        </section>`;
    }

    (async () => {
      for (const g of groups) {
        try {
          // NOTE: paths now "data/..." not "../data/..."
          const r = await loadJSON(`data/report-${g}.json`);
          if (!stamp.textContent) stamp.textContent = "Generated at " + new Date(r.generatedAt).toLocaleString();
          const div = document.createElement('div');
          div.innerHTML = sectionHTML(r.group || g, r.summary || []);
          grid.appendChild(div.firstElementChild);
        } catch {
          // group report not present; skip
        }
      }
    })();
  </script>
</body>
</html>
